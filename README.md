# SamurAI Coding 2017-18

## ディレクトリ構成
公式に準拠

- cource:製作したコースのデータ（json,smrjky）
- editor:コースのエディタ
- official:レースの実行管理システム
- player:ルーチン
- racelog:レースのログ
- viewer:レースログのビュワー

## 公式ドキュメントの所在
- 全体:`README-jp.txt`
- ゲームのルール:`documents/rule-jp.pdf`
- ファイル形式:`documents/datafiles.pdf`

## ルールの詳細
`2017/09/16版`準拠

- コースは2次元の格子点の集合で与えられる。
	- 幅w, コース長l, 格子点の座標を(x,y)(0≦x<w, 0≦y<l)とする。
	- 進入できない格子点である**障害点**を含む。また障害点の集合を障害物と称する。
		- 障害物の内部には侵入不可。飛び越えるのも不可。
		- 障害物の形状は凹ではなく、また適切な速度で移動すればプレイヤーがy座標を1度も小さくすることなくゴールできることが保証される。
			- 公式: `コースには行き止まりがないものとする. コース内のどの格子点からも, 十分小さい速度で移動すれば, 一度もy座標を減らすことなく障害物やコース端にぶつからずにy座標がより大きい点に移動できる. ` 

- プレイヤーの位置は常に格子点上になる。
	- レース中はつねに相異なるプレイヤーは相異なる格子点上に存在する。
	- レース開始時のy座標は0である。

- AIにはコースの情報は自分の座標±**視界**の範囲のみで与えられる。
	- 横方向（x座標）は常に全て見える。
	- 縦方向（y座標）は視界の制約を受ける(y座標±視界)。
	- 視界の値は開始時に与えられる。

- プレイヤー同士は**衝突**する。
	- コースアウトがない場合に両プレイヤの動線が交差あるいは接触すると衝突が発生する。
	- 衝突が生じた場合は、**優先権**を持つプレイヤの次ステップの位置は予定位置に,優先権のないプレイヤの位置は元のままになる。
		- 優先権は以下の順に判定する。
			- 相手プレイヤの動作前の位置に達するか通過するような動線を持つ場合は優先権を持たない。
				- お互いに相手の位置に達するか通過するような動線を持つ場合は両方とも優先権を持たない。
			- y座標が小さいプレイヤーが優先権を得る。
			- x座標が小さいプレイヤーが優先権を得る。

- プレイヤーのy座標がl以上になったらゴールとなる。スコアはゴールにかかったステップ数で計算される。
	- 公式:`プレイヤがステップsで座標 (x, y)の位置にあり, 次ステップで位置(x′, y′)に達し, y′ ≥ l (lはコース長) であるとき,そのプレイヤはゴールしたものとされる.このときゴールタイムはs+(l − y)/(y′ − y)で与えられる.`
	- ステップ数には上限値が与えられ、上限以内にゴールできなかった場合はステップ数の上限の2倍がスコアとなる。
	- コースアウト・衝突で座標が変わらなかった場合はゴールしない。

- AIには**考慮時間**の上限が与えられる。
	- 考慮時間はゲーム管理プログラムがプレイヤに情報を送信し終わってから、プレイヤからの応答を受信し終わるまでの実時間を元に計算される。
	- 考慮時間の合計が制限値を超えたプレイヤはそのレースを含むゲームを失う。
	- 考慮時間は数10秒程度となる予定らしい。
	- 考慮時間はマイクロ秒で与えられる。

### 入出力
- 入出力は空白・改行によって区切られた10進数の並び。
- 入力
	- 初期化時の入力順は*考慮時間*,*制限ステップ数*,*コースの幅・長さ*,*視界*
	- 毎ステップの入力順は*現在のステップ*,*残りの考慮時間*,*自プレイヤの座標・速度*,*相手プレイヤの座標・速度*,*障害点[(2×視界+1)×w個, y座標が小さい順]*
		- コース範囲外の格子点は1で与えられる。
		- 相手が視界外にいる場合、y座標は-1・それ以外の値は0で与えられる。
- 出力
	- 初期化終了時に初期化終了の応答(*単一の整数0*)を出力する。
	- ステップ終了時に加速度(*整数(∈{-1,0,1}を2つ*)を出力する。
	- 出力は空白・改行によって区切られた10進数の並び。
	- 最後に改行を出力する。
- AIは出力を行なったあと、管理システムによって次ステップの情報が入力されるまで停止する。
	- 計算はできないが情報は保持し続けることが出来る。
- AIはファイル出力・ネットワークアクセスができない。
	- 複数のレース間で情報を共有することはできない。

## TIPS
### レースの見方
```
viewer/viewer.html をブラウザで開きます。
左上端の Load Log ボタンを押すとダイアログが表示されますので、
ここでこのディレクトリ中の samples/sample.racelog を選んでください。
"Start" ボタンを押すとレースの進行を見ることができます。
詳しい使い方については "Help" ボタンを押してマニュアルページを見てください。
```

### 対戦スクリプトの実行
```
実行管理システムとサンプルプレイヤについては、各ディレクトリで make を走らせてください。
インストールには C++11 対応の C++ 言語システムと boost ライブラリが必要です。
```

```
コマンドラインに以下のように引数を指定します。
　　./official <course file> <player0> <name0> <player1> <name1> [ <log0> <log1> ]
各引数は以下のとおりです。

  <course file>:
    レースで用いる形式のコース記述ファイル。
    通常 editor でコースを設計して、Write で書き出したものです。
    サンプルが sample/sample-course.smrjky にあります。
  <player0>, <player1>:
    レースを競う AI プログラムの実行可能形式ファイルのパス名です。
    player ディレクトリで make すれば、サンプルが player/greedy にできます。
  <name0>, <name1>:
    Viewer の表示に使う AI プログラムの名前の文字列です。
  <log0>, <log1>
    これらのパス名を指定すると、AI プログラムに送ったデータのコピーを格納します。
    これらを AI プレイヤの入力とすれば、デバッグに便利でしょう。
```

### コース編集
```
editor/editor.html をブラウザで開きます。
右上端の Help ボタンを押して編集方法の詳細をご覧ください。
```
